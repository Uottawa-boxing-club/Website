<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>uOttawa Boxing Club</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root { --brand: #CC0000; }
      html, body { height: 100%; margin: 0; }
      body {
        font-family: Arial, sans-serif;
        min-height: 100vh;
        background-image: url("https://lh3.googleusercontent.com/d/1y4ab3yFowXEtM8kklRq7AfOFUeWbPsYS");
        background-repeat: no-repeat;
        background-position: center center;
        background-attachment: fixed;
        background-size: cover;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 40px 16px;
      }
      body::before {
        content: '';
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background-image: url("https://lh3.googleusercontent.com/d/1y4ab3yFowXEtM8kklRq7AfOFUeWbPsYS");
        background-repeat: no-repeat;
        background-position: center center;
        background-attachment: fixed;
        background-size: cover;
        filter: blur(3px);
        z-index: -1;
      }
      .container {
        background: rgba(255, 255, 255, 0.92);
        backdrop-filter: blur(2px);
        padding: 24px;
        border-radius: 10px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.25);
        width: 100%;
        max-width: 460px;
        text-align: center;
        position: relative;
      }
      .logo { max-width: 140px; margin-bottom: 12px; display: block; margin-inline: auto; }
      h2 { color: var(--brand); margin: 8px 0 16px; font-size: 24px; }

      .tabs { display: flex; gap: 6px; margin-bottom: 16px; }
      .mode-btn {
        background: #f8f9fa; color: #495057; border: 2px solid #dee2e6;
        padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; flex: 1;
        transition: all 0.25s;
      }
      .mode-btn.active { background: var(--brand); color: white; border-color: var(--brand); }
      .mode-btn:hover:not(.active) { background: #eef1f3; border-color: #cfd6dc; }

      .lang-toggle {
        position: absolute; top: 12px; right: 12px;
        display: inline-flex; gap: 6px; align-items: center;
        font-size: 12px; color: #444;
      }
      .lang-toggle button {
        background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 999px; padding: 6px 10px;
        cursor: pointer; font-weight: 600; color: #495057; transition: all 0.25s;
      }
      .lang-toggle button.active { background: var(--brand); color: #fff; border-color: var(--brand); }
      .lang-toggle button:hover:not(.active) { background: #eef1f3; border-color: #cfd6dc; }

      .success-message, .error-message {
        padding: 12px; border-radius: 6px; margin: 10px 0 4px; display: none; text-align: left; font-size: 14px;
      }
      .success-message { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
      .error-message   { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }

      input, select, button {
        width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #cccccc; border-radius: 6px; font-size: 14px; box-sizing: border-box;
      }
      input:focus, select:focus { border-color: var(--brand); outline: none; box-shadow: 0 0 0 3px rgba(204,0,0,0.15); }
      button { background: var(--brand); color: #fff; border: none; cursor: pointer; font-weight: bold; transition: background-color 0.25s, transform 0.05s; }
      button:hover:not(:disabled) { background: #a60000; }
      button:active:not(:disabled) { transform: translateY(1px); }
      button:disabled { background: #999; cursor: not-allowed; }

      #aboutContent, #instructionsContent { text-align: left; font-size: 15px; line-height: 1.55; color: #2a2a2a; }
      ul { padding-left: 18px; }
      small.helper { display:block; text-align:left; color:#5a5a5a; margin-top:-4px; }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Language toggle -->
      <div class="lang-toggle" aria-label="Language">
        <button type="button" id="btnEN" class="active">EN</button>
        <button type="button" id="btnFR">FR</button>
      </div>

      <img
        class="logo"
        src="https://lh3.googleusercontent.com/d/1vpMomvoOWO3GHcu0Blyc0t2AcVMWnr2w"
        alt="uOttawa Boxing Club Logo"
        onerror="this.src='https://via.placeholder.com/100x60/CC0000/FFFFFF?text=uOttawa+Boxing'; this.onerror=null;"
      />
      <h2 id="pageTitle">Register Now</h2>

      <div class="tabs">
        <button type="button" id="registerModeBtn" class="mode-btn active">Register</button>
        <button type="button" id="cancelModeBtn" class="mode-btn">Cancel</button>
        <button type="button" id="aboutModeBtn" class="mode-btn">About Us</button>
        <button type="button" id="instructionsModeBtn" class="mode-btn">Instructions</button>
      </div>

      <div id="successMessage" class="success-message"></div>
      <div id="errorMessage" class="error-message"></div>

      <!-- Registration / Cancel Form -->
      <form id="regForm">
        <input name="name" placeholder="Full name" maxlength="100" />
        <input name="email" type="email" placeholder="Email" maxlength="100" />
        <input name="phone" type="tel" placeholder="Phone number" maxlength="20" />

        <!-- Registration class selector -->
        <div id="classChoiceRow">
          <select name="classChoice" id="classChoice">
            <!-- options will be injected dynamically based on date -->
          </select>
        </div>

        <!-- Cancel selector (All / specific class) -->
        <div id="cancelAllRow" style="display:none;">
          <select id="cancelClassSelect">
            <!-- options will be injected dynamically based on date -->
          </select>
          <small id="cancelHelper" class="helper" style="display:block;">
            Choose the class to cancel, or pick <em>All my registrations</em>.
          </small>
        </div>

        <button type="submit" id="submitBtn">Register</button>
      </form>

      <!-- About Us -->
      <div id="aboutContent" style="display:none;">
        <p><strong>Welcome to the uOttawa Boxing Club!</strong> Our mission is to promote fitness, discipline, and community through boxing. We offer beginner-friendly fundamentals, conditioning, pad work, and safe sparring for those who are ready.</p>
        <p>We focus on proper technique, injury prevention, and an inclusive, supportive vibe. Whether youâ€™re just starting or building on experience, youâ€™ll find a place here.</p>
        <p><strong>Questions?</strong> Catch us after class or reach out via the registration email. See you in the gym! ðŸ¥Š</p>
      </div>

      <!-- Instructions -->
      <div id="instructionsContent" style="display:none;">
        <h3 style="margin:6px 0 8px;color:#333;">Before You Register</h3>
        <ul>
          <li><strong>Arrive early:</strong> please be at the gym <u>10 minutes before</u> start time.</li>
          <li><strong>Cancellation policy:</strong> <u>no cancellations within 12 hours</u> of class time.</li>
          <li><strong>Late arrivals:</strong> your spot may be given to the waitlist if you are late.</li>
        </ul>
        <h3 style="margin:12px 0 8px;color:#333;">Weekly Schedule</h3>
        <ul id="weeklyList">
          <!-- filled dynamically -->
        </ul>
        <p id="resetText" style="margin-top:10px;font-size:14px;color:#444;">
          Signups reset every <strong>Saturday at 11:00 AM</strong>.
        </p>
      </div>
    </div>

    <script>
      /***** Elements *****/
      const form = document.getElementById('regForm');
      const submitBtn = document.getElementById('submitBtn');
      const registerModeBtn = document.getElementById('registerModeBtn');
      const cancelModeBtn = document.getElementById('cancelModeBtn');
      const aboutModeBtn = document.getElementById('aboutModeBtn');
      const instructionsModeBtn = document.getElementById('instructionsModeBtn');
      const successMessage = document.getElementById('successMessage');
      const errorMessage = document.getElementById('errorMessage');
      const classChoiceRow = document.getElementById('classChoiceRow');
      const cancelAllRow = document.getElementById('cancelAllRow');
      const cancelClassSelect = document.getElementById('cancelClassSelect');
      const cancelHelper = document.getElementById('cancelHelper');
      const pageTitle = document.getElementById('pageTitle');
      const aboutContent = document.getElementById('aboutContent');
      const instructionsContent = document.getElementById('instructionsContent');
      const weeklyList = document.getElementById('weeklyList');
      const classChoice = document.getElementById('classChoice');

      // Language toggle
      const btnEN = document.getElementById('btnEN');
      const btnFR = document.getElementById('btnFR');

      /***** Date-based schedule (client-side mirror of server logic) *****/
      function isOverrideWeekClient(now = new Date()) {
        // EFFECTIVE NOW: Sat Sep 27, 2025 to Mon Oct 6, 2025 (exclusive)
        const start = new Date('2025-09-27T00:00:00-04:00');
        const end   = new Date('2025-10-06T00:00:00-04:00');
        return now >= start && now < end;
      }
      function currentScheduleClient() {
        if (isOverrideWeekClient()) {
          return {
            // values must match what users will submit and what server regex can detect
            day1Value: 'Tuesday 4:30â€“5:30 PM',
            day2Value: 'Wednesday 4:00â€“5:00 PM',
            day1EN: 'Tuesday: 4:30â€“5:30 PM',
            day2EN: 'Wednesday: 4:00â€“5:00 PM',
            day1FR: 'Mardi : 16 h 30 â€“ 17 h 30',
            day2FR: 'Mercredi : 16 h 00 â€“ 17 h 00',
            weeklyEN: ['Tuesdays: 4:30â€“5:30 PM','Wednesdays: 4:00â€“5:00 PM'],
            weeklyFR: ['Mardis : 16 h 30 â€“ 17 h 30','Mercredis : 16 h 00 â€“ 17 h 00']
          };
        }
        return {
          day1Value: 'Tuesday 4:30â€“5:30 PM',
          day2Value: 'Friday 2:30â€“3:30 PM',
          day1EN: 'Tuesday: 4:30â€“5:30 PM',
          day2EN: 'Friday: 2:30â€“3:30 PM',
          day1FR: 'Mardi : 16 h 30 â€“ 17 h 30',
          day2FR: 'Vendredi : 14 h 30 â€“ 15 h 30',
          weeklyEN: ['Tuesdays: 4:30â€“5:30 PM','Fridays: 2:30â€“3:30 PM'],
          weeklyFR: ['Mardis : 16 h 30 â€“ 17 h 30','Vendredis : 14 h 30 â€“ 15 h 30']
        };
      }

      /***** i18n strings (EN/FR) *****/
      const i18n = {
        en: {
          pageTitle: 'Register Now',
          tabs: { register: 'Register', cancel: 'Cancel', about: 'About Us', instructions: 'Instructions' },
          inputs: { name: 'Full name', email: 'Email', phone: 'Phone number' },
          registerSelectPlaceholder: 'Select a class day',
          cancelSelectAll: 'All my registrations',
          cancelHelper: 'Choose the class to cancel, or pick All my registrations.',
          submitRegister: 'Register',
          submitCancel: 'Cancel Registration',
          msgFillAll: 'Please fill in all fields.',
          msgEmailOnly: 'Please enter your email to cancel.',
          aboutTitle: 'About Us',
          instructionsTitle: 'Instructions',
          beforeYouRegister: 'Before You Register',
          arriveEarly: 'Arrive early: please be at the gym 10 minutes before start time.',
          cancellation: 'Cancellation policy: no cancellations within 12 hours of class time.',
          late: 'Late arrivals: your spot may be given to the waitlist if you are late.',
          weeklySchedule: 'Weekly Schedule',
          reset: 'Signups reset every Saturday at 11:00 AM.',
          successRegistered: 'Registered successfully! Check your email for confirmation.',
          successCancelled: (deleted, promoted) =>
            `Cancelled ${deleted} entr${deleted === 1 ? 'y' : 'ies'}. Promoted ${promoted} from the waitlist.`
        },
        fr: {
          pageTitle: 'Inscrivez-vous maintenant',
          tabs: { register: 'Inscription', cancel: 'Annuler', about: 'Ã€ propos', instructions: 'Consignes' },
          inputs: { name: 'Nom complet', email: 'Courriel', phone: 'NumÃ©ro de tÃ©lÃ©phone' },
          registerSelectPlaceholder: 'Choisissez une journÃ©e de cours',
          cancelSelectAll: 'Toutes mes inscriptions',
          cancelHelper: 'Choisissez le cours Ã  annuler, ou sÃ©lectionnez Â« Toutes mes inscriptions Â».',
          submitRegister: 'Sâ€™inscrire',
          submitCancel: 'Annuler lâ€™inscription',
          msgFillAll: 'Veuillez remplir tous les champs.',
          msgEmailOnly: 'Veuillez entrer votre courriel pour annuler.',
          aboutTitle: 'Ã€ propos',
          instructionsTitle: 'Consignes',
          beforeYouRegister: 'Avant de vous inscrire',
          arriveEarly: 'Arrivez tÃ´t : soyez au gym 10 minutes avant le dÃ©but du cours.',
          cancellation: 'Politique dâ€™annulation : aucune annulation dans les 12 heures prÃ©cÃ©dant le cours.',
          late: 'Retards : votre place peut Ãªtre donnÃ©e Ã  la liste dâ€™attente si vous arrivez en retard.',
          weeklySchedule: 'Horaire hebdomadaire',
          reset: 'Les inscriptions sont rÃ©initialisÃ©es chaque samedi Ã  11 h.',
          successRegistered: 'Inscription rÃ©ussie! VÃ©rifiez votre courriel pour la confirmation.',
          successCancelled: (deleted, promoted) =>
            `AnnulÃ© : ${deleted} entr${deleted === 1 ? 'Ã©e' : 'Ã©es'}. Promu : ${promoted} depuis la liste dâ€™attente.`
        }
      };

      let lang = localStorage.getItem('lang') || 'en';
      let currentMode = 'register';

      function hideMessages() {
        successMessage.style.display = 'none';
        errorMessage.style.display = 'none';
        successMessage.textContent = '';
        errorMessage.textContent = '';
      }

      function rebuildClassSelects() {
        const sched = currentScheduleClient();
        // Registration select
        classChoice.innerHTML = '';
        const opt0 = document.createElement('option');
        opt0.value = '';
        opt0.textContent = (i18n[lang].registerSelectPlaceholder);
        classChoice.appendChild(opt0);

        const opt1 = document.createElement('option');
        opt1.value = sched.day1Value;
        opt1.textContent = (lang === 'fr') ? sched.day1FR : sched.day1EN;
        classChoice.appendChild(opt1);

        const opt2 = document.createElement('option');
        opt2.value = sched.day2Value;
        opt2.textContent = (lang === 'fr') ? sched.day2FR : sched.day2EN;
        classChoice.appendChild(opt2);

        // Cancel select
        cancelClassSelect.innerHTML = '';
        const c0 = document.createElement('option');
        c0.value = '__ALL__';
        c0.textContent = (i18n[lang].cancelSelectAll || 'All my registrations');
        cancelClassSelect.appendChild(c0);

        const c1 = document.createElement('option');
        c1.value = sched.day1Value;
        c1.textContent = (lang === 'fr') ? ('Uniquement ' + sched.day1FR) : ('Only ' + sched.day1EN);
        cancelClassSelect.appendChild(c1);

        const c2 = document.createElement('option');
        c2.value = sched.day2Value;
        c2.textContent = (lang === 'fr') ? ('Uniquement ' + sched.day2FR) : ('Only ' + sched.day2EN);
        cancelClassSelect.appendChild(c2);

        // Instructions weekly list
        weeklyList.innerHTML = '';
        const weekly = (lang === 'fr') ? sched.weeklyFR : sched.weeklyEN;
        weekly.forEach(txt => {
          const li = document.createElement('li');
          li.textContent = txt;
          weeklyList.appendChild(li);
        });
      }

      function setLang(next) {
        lang = next;
        localStorage.setItem('lang', lang);
        btnEN.classList.toggle('active', lang === 'en');
        btnFR.classList.toggle('active', lang === 'fr');

        const t = i18n[lang];
        registerModeBtn.textContent = t.tabs.register;
        cancelModeBtn.textContent = t.tabs.cancel;
        aboutModeBtn.textContent = t.tabs.about;
        instructionsModeBtn.textContent = t.tabs.instructions;

        form.name.placeholder = t.inputs.name;
        form.email.placeholder = t.inputs.email;
        form.phone.placeholder = t.inputs.phone;

        cancelHelper.textContent = t.cancelHelper;
        document.querySelector('#instructionsContent h3').textContent = t.beforeYouRegister;

        const instrLis = document.querySelectorAll('#instructionsContent ul:first-of-type li');
        instrLis[0].innerHTML = `<strong>${t.arriveEarly.split(':')[0]}:</strong> ${t.arriveEarly.split(': ').slice(1).join(': ')}`;
        instrLis[1].innerHTML = `<strong>${t.cancellation.split(':')[0]}:</strong> ${t.cancellation.split(': ').slice(1).join(': ')}`;
        instrLis[2].innerHTML = `<strong>${t.late.split(':')[0]}:</strong> ${t.late.split(': ').slice(1).join(': ')}`;

        document.querySelectorAll('#instructionsContent h3')[1].textContent = t.weeklySchedule;
        document.getElementById('resetText').textContent = t.reset;

        // Rebuild selects and weekly schedule for the selected language & current week
        rebuildClassSelects();

        // Title & submit based on mode
        if (currentMode === 'register') {
          pageTitle.textContent = t.pageTitle;
          submitBtn.textContent = t.submitRegister;
        } else if (currentMode === 'cancel') {
          pageTitle.textContent = t.tabs.cancel;
          submitBtn.textContent = t.submitCancel;
        } else if (currentMode === 'about') {
          pageTitle.textContent = t.aboutTitle;
        } else if (currentMode === 'instructions') {
          pageTitle.textContent = t.instructionsTitle;
        }
      }

      function switchMode(mode) {
        currentMode = mode;
        [registerModeBtn, cancelModeBtn, aboutModeBtn, instructionsModeBtn].forEach(b => b.classList.remove('active'));
        form.style.display = 'none';
        aboutContent.style.display = 'none';
        instructionsContent.style.display = 'none';
        hideMessages();

        const t = i18n[lang];

        if (mode === 'register') {
          registerModeBtn.classList.add('active');
          form.style.display = '';
          classChoiceRow.style.display = 'block';
          cancelAllRow.style.display = 'none';
          submitBtn.textContent = t.submitRegister;
          pageTitle.textContent = t.pageTitle;
        }
        if (mode === 'cancel') {
          cancelModeBtn.classList.add('active');
          form.style.display = '';
          classChoiceRow.style.display = 'none';
          cancelAllRow.style.display = 'block';
          submitBtn.textContent = t.submitCancel;
          pageTitle.textContent = t.tabs.cancel;
        }
        if (mode === 'about') {
          aboutModeBtn.classList.add('active');
          aboutContent.style.display = '';
          pageTitle.textContent = t.aboutTitle;
        }
        if (mode === 'instructions') {
          instructionsModeBtn.classList.add('active');
          instructionsContent.style.display = '';
          pageTitle.textContent = t.instructionsTitle;
        }
      }

      // Event listeners
      registerModeBtn.addEventListener('click', () => switchMode('register'));
      cancelModeBtn.addEventListener('click', () => switchMode('cancel'));
      aboutModeBtn.addEventListener('click', () => switchMode('about'));
      instructionsModeBtn.addEventListener('click', () => switchMode('instructions'));
      btnEN.addEventListener('click', () => setLang('en'));
      btnFR.addEventListener('click', () => setLang('fr'));

      form.addEventListener('submit', (e) => {
        e.preventDefault();
        hideMessages();

        const t = i18n[lang];
        const base = {
          name: (form.name.value || '').trim(),
          email: (form.email.value || '').trim(),
          phone: (form.phone.value || '').trim()
        };

        if (currentMode === 'register') {
          const selected = (classChoice.value || '').trim();
          if (!base.name || !base.email || !base.phone || !selected) {
            errorMessage.textContent = t.msgFillAll;
            errorMessage.style.display = 'block';
            return;
          }
          base.classChoice = selected;
          submitBtn.textContent = t.submitRegister.replace(/e?$/, 'ingâ€¦');
        } else if (currentMode === 'cancel') {
          if (!base.email) {
            errorMessage.textContent = t.msgEmailOnly;
            errorMessage.style.display = 'block';
            return;
          }
          const sel = cancelClassSelect.value;
          base.classChoice = (sel === '__ALL__') ? '' : sel;
          submitBtn.textContent = t.submitCancel + 'â€¦';
        }

        submitBtn.disabled = true;
        const fn = currentMode === 'register' ? 'registerNew' : 'cancelRegistration';

        google.script.run
          .withSuccessHandler((res) => {
            if (res && res.success) {
              let msg;
              if (currentMode === 'register') {
                msg = i18n[lang].successRegistered;
              } else {
                const del = Number(res.deleted || 0);
                const prom = Number(res.promoted || 0);
                msg = i18n[lang].successCancelled(del, prom);
              }
              successMessage.textContent = msg;
              successMessage.style.display = 'block';
              form.reset();
              cancelClassSelect.value = '__ALL__';
            } else {
              errorMessage.textContent = (res && res.error) || 'Operation failed. Please try again.';
              errorMessage.style.display = 'block';
            }
            submitBtn.disabled = false;
            submitBtn.textContent = currentMode === 'register' ? t.submitRegister : t.submitCancel;
            window.scrollTo(0, 0);
          })
          .withFailureHandler((err) => {
            errorMessage.textContent = (err && err.message) || 'Request failed.';
            errorMessage.style.display = 'block';
            submitBtn.disabled = false;
            submitBtn.textContent = currentMode === 'register' ? t.submitRegister : t.submitCancel;
            window.scrollTo(0, 0);
          })[fn](base);
      });

      // Initialize
      setLang(lang);               // sets language text
      rebuildClassSelects();       // builds selects for current week & language
      switchMode('register');      // default mode
      cancelClassSelect.value = '__ALL__';
    </script>
  </body>
</html>
